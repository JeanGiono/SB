<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>影響空軍修護人員離職因素之研究問卷</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', '微軟正黑體', 'Microsoft JhengHei', sans-serif;
        }
        .aspect-cell {
            min-width: 60px; /* 確保評分單元格有足夠寬度 */
            text-align: center;
        }
        .input-cell {
            width: 4em; /* 調整輸入框寬度 */
            padding: 0.3rem;
            text-align: center;
            border: 1px solid #cbd5e1;
            border-radius: 0.25rem;
        }
        .input-cell:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
            outline: none;
        }
        th, td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #e2e8f0; /* 更淺的邊框顏色 */
        }
        /* Style for sticky headers */
        .dematel-table thead th { /* Column headers */
            position: sticky;
            top: 0;
            background-color: #f1f5f9; /* Tailwind's slate-100 */
            z-index: 20; /* Higher than row headers */
        }
        .dematel-table tbody td:first-child { /* Row headers */
            position: sticky;
            left: 0;
            background-color: #f8fafc; /* Tailwind's slate-50 */
            z-index: 10; /* Higher than normal cells, lower than column headers */
            font-weight: 600; /* semibold */
        }
        .dematel-table thead th:first-child { /* Top-left corner cell */
            left: 0;
            z-index: 30; /* Highest z-index */
        }

        .diagonal-cell {
            background-color: #4b5563; /* 深灰色背景，模擬反黑 */
            color: #4b5563; /* 文字顏色與背景相同，使其不可見 */
            user-select: none; /* 防止選取文字 */
            vertical-align: middle;
        }
        .custom-alert {
            display: none;
            position: fixed;
            left: 50%;
            top: 20px;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            background-color: #fef2f2; /* Red-100 */
            color: #b91c1c; /* Red-700 */
            border: 1px solid #fecaca; /* Red-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 1000;
            font-size: 0.875rem; /* text-sm */
        }
        .custom-alert button {
            margin-left: 1rem;
            background-color: transparent;
            border: none;
            color: #b91c1c; /* Red-700 */
            font-weight: bold;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .dematel-table-container {
                overflow-x: auto; /* 在小螢幕上啟用水平滾動 */
                max-height: 500px; /* 增加一個最大高度以便測試垂直滾動 */
            }
            .dematel-table th, .dematel-table td {
                min-width: 80px; /* 小螢幕上調整最小寬度 */
                font-size: 0.875rem; /* 調整字體大小 */
            }
            .dematel-table .aspect-name-col { /* Class for the first th/td in a row */
                min-width: 100px; /* 小螢幕上構面名稱列的最小寬度 */
                white-space: normal; /* 允許換行 */
            }
            .input-cell {
                width: 3.5em;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <div id="customAlert" class="custom-alert">
        <span id="customAlertMessage"></span>
        <button onclick="document.getElementById('customAlert').style.display='none'">&times;</button>
    </div>

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-lg shadow-xl">
        <header class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-sky-700 mb-2">「影響空軍修護人員離職因素之研究」問卷</h1>
            <p class="text-sm text-gray-600">
                這是一份純學術之問卷研究，本問卷所有資料僅作為研究之目的，絕對保密，請您依實際感受最直接的反應填寫此份問卷，誠摯感謝您熱心的協助！
            </p>
            <div class="mt-2 text-xs text-gray-500">
                <p>國立台北大學企業管理研究所</p>
                <p>指導教授：劉仲矩 老師</p>
                <p>研究生：張靖<y_bin_199> 學生</p>
            </div>
        </header>

        <section class="mb-8 p-4 bg-sky-50 rounded-md border border-sky-200">
            <h2 class="text-lg font-semibold text-sky-700 mb-3">壹、十五項構面影響關係之評比</h2>
            <p class="text-sm text-gray-700 mb-2"><strong>填寫指標說明：</strong></p>
            <ul class="list-disc list-inside text-sm text-gray-700 mb-2 space-y-1">
                <li><strong>0：</strong>完全沒有影響</li>
                <li><strong>1：</strong>低度影響</li>
                <li><strong>2：</strong>中度影響</li>
                <li><strong>3：</strong>高度影響</li>
                <li><strong>4：</strong>極高度影響</li>
            </ul>
            <p class="text-sm text-gray-700 mb-2"><strong>舉例說明：</strong>若您認為 A 構面對 B 構面之影響程度為「高影響」(3)，則在 A 列 B 行的儲存格中輸入 3。</p>
            <p class="text-sm text-gray-700 font-medium bg-amber-100 p-2 rounded-md border border-amber-300">
                <span class="font-bold text-red-600">請特別注意：</span>構面間互相影響並不一定相等。
                例如：A 構面對 B 構面之影響程度為「極高影響」(4)；而 B 構面對 A 構面之影響程度可能為「高影響」(3)。
            </p>
        </section>

        <section class="mb-8 p-4 bg-emerald-50 rounded-md border border-emerald-200">
            <h2 class="text-lg font-semibold text-emerald-700 mb-3">貳、填答問卷之範例</h2>
            <p class="text-sm text-gray-700 mb-2">(0：無影響；1：低影響；2：中影響；3：高影響；4：極高影響)</p>
            <div class="overflow-x-auto">
                <table class="min-w-full text-xs border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="border border-gray-300 p-1">影響構面↓ \ 被影響構面→</th>
                            <th class="border border-gray-300 p-1">A</th>
                            <th class="border border-gray-300 p-1">B</th>
                            <th class="border border-gray-300 p-1">C</th>
                            <th class="border border-gray-300 p-1">D</th>
                            <th class="border border-gray-300 p-1">E</th>
                            <th class="border border-gray-300 p-1">F</th>
                            <th class="border border-gray-300 p-1">G</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>A</strong></td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">3</td><td class="p-1">4</td><td class="p-1">2</td><td class="p-1">0</td><td class="p-1">1</td><td class="p-1">2</td></tr>
                        <tr><td><strong>B</strong></td><td class="p-1">0</td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">3</td><td class="p-1">4</td><td class="p-1">2</td><td class="p-1">1</td><td class="p-1">1</td></tr>
                        <tr><td><strong>C</strong></td><td class="p-1">2</td><td class="p-1">4</td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">3</td><td class="p-1">3</td><td class="p-1">4</td><td class="p-1">0</td></tr>
                        <tr><td><strong>D</strong></td><td class="p-1">3</td><td class="p-1">4</td><td class="p-1">1</td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">3</td><td class="p-1">2</td><td class="p-1">4</td></tr>
                        <tr><td><strong>E</strong></td><td class="p-1">1</td><td class="p-1">3</td><td class="p-1">1</td><td class="p-1">2</td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">4</td><td class="p-1">4</td></tr>
                        <tr><td><strong>F</strong></td><td class="p-1">0</td><td class="p-1">4</td><td class="p-1">2</td><td class="p-1">1</td><td class="p-1">3</td><td class="diagonal-cell p-1 align-middle">██</td><td class="p-1">3</td></tr>
                        <tr><td><strong>G</strong></td><td class="p-1">3</td><td class="p-1">3</td><td class="p-1">4</td><td class="p-1">0</td><td class="p-1">3</td><td class="p-1">4</td><td class="diagonal-cell p-1 align-middle">██</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="text-xs text-gray-600 mt-2"><em>(填答時請注意：此表格右上方與左下方之答案不一定對稱)</em></p>
        </section>

        <form id="dematelForm">
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">參、DEMATEL 影響程度評估表</h2>
                <div class="dematel-table-container">
                    <table class="min-w-full border-collapse border border-gray-300 dematel-table">
                        <thead>
                            <tr>
                                <th class="p-2 border aspect-name-col">影響構面(i)↓ \ 被影響構面(j)→</th>
                                <!-- Headers generated by JavaScript -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="mb-8 p-4 bg-indigo-50 rounded-md border border-indigo-200">
                <h2 class="text-lg font-semibold text-indigo-700 mb-3">構面定義說明</h2>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li><strong>1. 勞役不均：</strong> 工作任務分配不合理，常以低階優先，導致部分人員承擔過多工作。</li>
                    <li><strong>2. 任務壓力：</strong> 工作時間過長，工作量過多或工作內容過於繁重導致身心疲憊。</li>
                    <li><strong>3. 職業傷害：</strong> 飛機修護環境噪音過大，或需長時間承受大量廢氣或化學溶劑。</li>
                    <li><strong>4. 薪資待遇：</strong> 薪資待遇沒辦法確實反應在高工時或高壓工作環境。</li>
                    <li><strong>5. 成就實現：</strong> 從工作中獲得的自我價值感與滿足感不足，缺乏對個人能力與貢獻的肯定。</li>
                    <li><strong>6. 職涯發展：</strong> 軍職專長與民間產業難以銜接，需提早退伍提升職涯競爭力。</li>
                    <li><strong>7. 社會認同：</strong> 自覺社會大眾對軍人職業認同感低，進而影響自豪感並降低留營意願。</li>
                    <li><strong>8. 期望落差：</strong> 部隊工作內容與個人預期想像落差過大。</li>
                    <li><strong>9. 權威壓迫：</strong> 單位存在不健康的權力關係，高階濫用職權使部屬感到壓迫及不尊重。</li>
                    <li><strong>10. 同袍互動：</strong> 同袍間價值觀、個性、工作行為相左在溝通協作上產生困難或衝突。</li>
                    <li><strong>11. 人力匱乏：</strong> 人員離退後單位職缺人力長時間未能補充，增加工時負荷。</li>
                    <li><strong>12. 輕視專業：</strong> 修護人員與飛行人員意見相左時，修護人員的意見往往難以被採納。</li>
                    <li><strong>13. 家庭照顧：</strong> 工作佔據私人時間過多對家庭照護不足無法充分陪伴家人。</li>
                    <li><strong>14. 就業市場：</strong> 民間企業提供更具吸引力的職涯發展機會工作選擇更加多元。</li>
                    <li><strong>15. 政策疑慮：</strong> 國家退撫、薪資政策變動頻繁，使得軍人對於未來權益保障產生不確定感與擔憂。</li>
                </ul>
            </section>

            <section class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">肆、個人基本資料</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">1. 性別：</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center"><input type="radio" name="gender" value="male" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 生理男</label>
                            <label class="flex items-center"><input type="radio" name="gender" value="female" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 生理女</label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">2. 年資：</label>
                        <select name="experience" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm">
                            <option value="">請選擇</option>
                            <option value="0-5">0-5年</option>
                            <option value="5-10">5-10年</option>
                            <option value="10-15">10-15年</option>
                            <option value="15-20">15-20年</option>
                            <option value="20+">20-25年(含以上)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">3. 教育程度：</label>
                        <select name="education" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm">
                            <option value="">請選擇</option>
                            <option value="high_school">高中</option>
                            <option value="junior_college">專科</option>
                            <option value="university">大學</option>
                            <option value="postgraduate">研究所(含以上)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">4. 階級：</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center"><input type="radio" name="rank" value="soldier" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 士兵</label>
                            <label class="flex items-center"><input type="radio" name="rank" value="nco" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 士官</label>
                            <label class="flex items-center"><input type="radio" name="rank" value="officer" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 軍官</label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">5. 職務類型：</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center"><input type="radio" name="job_type" value="leadership" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 領導職</label>
                            <label class="flex items-center"><input type="radio" name="job_type" value="non_leadership" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 非領導職</label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">6. 兵役情況：</label>
                        <div class="flex flex-col space-y-2">
                             <label class="flex items-center"><input type="radio" name="military_service_status" value="active" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 現役</label>
                             <div class="ml-0">
                                <label class="flex items-center mt-1"><input type="radio" name="military_service_status" value="retired" id="retired_radio" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 已退役</label>
                                <div id="retired_options" class="ml-6 mt-1 space-y-1 hidden">
                                   <label class="flex items-center"><input type="radio" name="military_service_detail" value="retired_completed" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 服滿役期</label>
                                   <label class="flex items-center"><input type="radio" name="military_service_detail" value="retired_incomplete" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1"> 未服滿役期</label>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="mt-10 text-center">
                <button type="submit" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    提交問卷
                </button>
            </div>
        </form>

        <footer class="mt-12 text-center text-sm text-gray-600 border-t pt-6">
            <p>此份問卷到此結束，感謝您在百忙之中撥冗填答，衷心感謝您對本研究之支持！</p>
        </footer>
    </div>

    <script>
        const aspects = [
            "勞役不均", "任務壓力", "職業傷害", "薪資待遇", "成就實現",
            "職涯發展", "社會認同", "期望落差", "權威壓迫", "同袍互動",
            "人力匱乏", "輕視專業", "家庭照顧", "就業市場", "政策疑慮"
        ];

        const dematelTable = document.querySelector('.dematel-table');
        const headerRow = dematelTable.querySelector('thead tr');
        const tbody = dematelTable.querySelector('tbody');

        // Function to show custom alert
        function showAlert(message) {
            const alertBox = document.getElementById('customAlert');
            const alertMessage = document.getElementById('customAlertMessage');
            alertMessage.textContent = message;
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3000);
        }

        // 生成表頭 - JavaScript動態添加的部分
        // 移除靜態HTML中第一列表頭的 sticky 和 z-index 相關class，統一由CSS控制
        const firstHeaderCell = headerRow.querySelector('th');
        firstHeaderCell.className = 'p-2 border aspect-name-col'; // 基本樣式

        aspects.forEach(aspect => {
            const th = document.createElement('th');
            th.className = 'p-1 md:p-2 border aspect-cell'; // 基本樣式，sticky由CSS class .dematel-table thead th 控制
            th.textContent = aspect;
            headerRow.appendChild(th);
        });

        // 生成表格內容
        aspects.forEach((rowAspect, rowIndex) => {
            const tr = document.createElement('tr');
            const firstTd = document.createElement('td');
            // classname 由 CSS .dematel-table tbody td:first-child 控制 sticky
            firstTd.className = 'p-1 md:p-2 border aspect-name-col'; 
            firstTd.textContent = rowAspect;
            tr.appendChild(firstTd);

            aspects.forEach((colAspect, colIndex) => {
                const td = document.createElement('td');
                td.className = 'p-1 border aspect-cell';
                if (rowIndex === colIndex) {
                    td.classList.add('diagonal-cell');
                    td.textContent = '██';
                    td.style.verticalAlign = 'middle';
                } else {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.max = '4';
                    input.name = `rating_${rowIndex}_${colIndex}`;
                    input.className = 'input-cell';
                    input.setAttribute('data-row', rowIndex);
                    input.setAttribute('data-col', colIndex);

                    input.addEventListener('input', function(e) {
                        const value = parseInt(e.target.value, 10);
                        if (e.target.value !== "" && (isNaN(value) || value < 0 || value > 4)) {
                            showAlert('輸入錯誤！請輸入 0 到 4 之間的數字。');
                            e.target.value = '';
                        }
                    });
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                        }
                    });
                    td.appendChild(input);
                }
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
        
        const retiredRadio = document.getElementById('retired_radio');
        const retiredOptions = document.getElementById('retired_options');
        const activeRadio = document.querySelector('input[name="military_service_status"][value="active"]');
        const retiredDetailRadios = document.querySelectorAll('input[name="military_service_detail"]');

        function toggleRetiredOptions() {
            if (retiredRadio.checked) {
                retiredOptions.classList.remove('hidden');
            } else {
                retiredOptions.classList.add('hidden');
                retiredDetailRadios.forEach(radio => radio.checked = false);
            }
        }
        
        if(activeRadio) activeRadio.addEventListener('change', toggleRetiredOptions);
        if(retiredRadio) retiredRadio.addEventListener('change', toggleRetiredOptions);

        document.getElementById('dematelForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            let allValid = true;
            let firstInvalidElement = null;

            aspects.forEach((rowAspect, rowIndex) => {
                aspects.forEach((colAspect, colIndex) => {
                    if (rowIndex !== colIndex) {
                        const inputField = document.querySelector(`input[name="rating_${rowIndex}_${colIndex}"]`);
                        const valueStr = inputField.value;
                        if (valueStr === "") {
                            data[`${rowAspect}_影響_${colAspect}`] = null;
                        } else {
                            const value = parseInt(valueStr, 10);
                            if (isNaN(value) || value < 0 || value > 4) {
                                allValid = false;
                                inputField.classList.add('border-red-500');
                                if (!firstInvalidElement) firstInvalidElement = inputField;
                                data[`${rowAspect}_影響_${colAspect}`] = "無效輸入";
                            } else {
                                data[`${rowAspect}_影響_${colAspect}`] = value;
                                inputField.classList.remove('border-red-500');
                            }
                        }
                    }
                });
            });

            if (!allValid) {
                showAlert('部分DEMATEL評分輸入無效或超出範圍 (0-4)，請檢查標紅的欄位。');
                if (firstInvalidElement) firstInvalidElement.focus();
                return;
            }

            data.gender = formData.get('gender');
            data.experience = formData.get('experience');
            data.education = formData.get('education');
            data.rank = formData.get('rank');
            data.job_type = formData.get('job_type');
            
            const militaryStatus = formData.get('military_service_status');
            data.military_service_status = militaryStatus;
            if (militaryStatus === 'retired') {
                data.military_service_detail = formData.get('military_service_detail');
            } else {
                data.military_service_detail = null;
            }

            console.log("表單資料:", data);
            showAlert('問卷資料已在主控台打印，通常此處會提交至伺服器。');
        });
    </script>
</body>
</html>
