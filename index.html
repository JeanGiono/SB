<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>影響空軍修護人員離職因素之研究問卷</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', '微軟正黑體', 'Microsoft JhengHei', sans-serif;
            scroll-behavior: smooth; 
        }

        /* --- 1. 禁用瀏覽器提示頁面樣式 --- */
        #browser-blocker {
            display: none; /* 預設隱藏 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f8fafc; /* Tailwind slate-50 */
            z-index: 2000;
            padding: 2rem;
            text-align: center;
        }
        #browser-blocker-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        /* --- 2. DEMATEL 主評估表樣式 --- */
        .dematel-table th, .dematel-table td {
            padding: 0.5rem 0.25rem; 
            text-align: center;
            border: 1px solid #e2e8f0; 
            vertical-align: middle; 
        }
        .dematel-table thead th.aspect-cell { /* 頂部橫向表頭 */
            min-width: 4.8rem; 
            height: 4.5em;    
            line-height: 1.35; 
            padding-top: 0.4rem; 
            padding-bottom: 0.4rem;
            font-weight: 600; 
        }
        .dematel-table tbody td.aspect-name-col { /* 左側縱向表頭 */
            min-width: 6.5rem; 
            height: 3.5em;   
            line-height: 1.35;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            font-weight: 600;
            background-color: #f8fafc; 
            position: sticky;
            left: 0;
            z-index: 10;
        }
        .dematel-table thead th.aspect-name-col { /* 左上角標題 */
             min-width: 8.5rem; 
             height: 4.5em; 
             line-height: 1.35;
             background-color: #f1f5f9; 
             position: sticky;
             top: 0;
             left: 0;
             z-index: 30;
             font-weight: 600;
        }
        .dematel-table td.input-cell-container { /* 輸入格容器 */
            height: 3.5em; 
            padding: 0.25rem; 
        }
        .input-cell { /* 輸入框本身 */
            width: 100%; 
            max-width: 4em; 
            padding: 0.4rem 0.2rem;
            text-align: center;
            border: 1px solid #cbd5e1; 
            border-radius: 0.25rem;
            box-sizing: border-box; 
        }
        .input-cell:focus {
            border-color: #3b82f6; 
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
            outline: none;
        }
        .dematel-table td.diagonal-cell { /* 對角線儲存格 */
            background-color: #4b5563; 
            color: #4b5563;
            user-select: none;
            height: 3.5em; 
        }
        .dematel-table thead th { /* 凍結頂部表頭 */
            position: sticky;
            top: 0;
            background-color: #f1f5f9; 
            z-index: 20;
        }

        /* --- 3. 錯誤提示樣式 --- */
        .input-cell.error-empty { 
            border-color: #ef4444 !important; 
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3) !important;
        }
        .input-cell.error-range { 
             border-color: #f97316 !important; 
             box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.3) !important;
        }
        .personal-info-field.error-empty-group > label:first-of-type, 
        .personal-info-field.error-empty-group .radio-options-grid,
        .personal-info-field.error-empty-group .flex.items-center.space-x-6, 
        .personal-info-field.error-empty-group .flex.flex-col.space-y-2,
        #retired_options.error-empty-group
         {
            border-left: 3px solid #ef4444; 
            padding-left: 0.5rem;
            background-color: #fef2f2; 
        }
        .custom-alert { display: none; position: fixed; left: 50%; top: 20px; transform: translateX(-50%); padding: 1rem 1.5rem; background-color: #fef2f2; color: #b91c1c; border: 1px solid #fecaca; border-radius: 0.375rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); z-index: 1000; font-size: 0.875rem; }
        .custom-alert button { margin-left: 1rem; background-color: transparent; border: none; color: #b91c1c; font-weight: bold; cursor: pointer; }
        
        /* --- 4. 範例表格樣式 --- */
        .example-table-示意 { 
            border-collapse: collapse; margin-left: auto; margin-right: auto; border: 1px solid #9ca3af; 
        }
        .example-table-示意 th, .example-table-示意 td {
            border: 1px solid #9ca3af; width: 3rem; height: 3rem; padding: 0; text-align: center; vertical-align: middle; font-size: 0.875rem; line-height: 3rem; 
        }
        .example-table-示意 th { background-color: #e5e7eb; font-weight: bold; }
        .example-table-示意 td.diagonal-cell-示意 { background-color: #374151; color: #374151; }

        .example-table-square { border-collapse: collapse; margin-left: auto; margin-right: auto; }
        .example-table-square th, .example-table-square td {
            border: 1px solid #9ca3af; width: 2.5rem; height: 2.5rem; padding: 0; text-align: center; vertical-align: middle; font-size: 0.875rem; line-height: 2.5rem; 
        }
        .example-table-square th { background-color: #e5e7eb; font-weight: bold; }
        .example-table-square td.diagonal-cell-example { background-color: #374151; color: #374151; }
        
        /* --- 5. 其他通用樣式 --- */
        .radio-options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(7.5rem, 1fr)); gap: 0.5rem; }

        /* --- 6. 列印專用樣式 --- */
        @media print {
            body { font-size: 10pt; margin: 0; padding: 0; background-color: #fff; }
            .max-w-4xl { max-width: 100%; box-shadow: none; border: none; padding: 1cm; }
            header, section:not(#printSectionDematalTable):not(#printSectionPersonalData), form > div:last-of-type, footer, #customAlert, .dematel-table-container { display: none !important; }
            #printSectionDematalTable { display: block !important; margin-bottom: 20px; overflow: visible; }
            #printSectionDematalTable table { width: 100%; font-size: 8pt; border-collapse: collapse; table-layout: fixed; }
            #printSectionDematalTable th, #printSectionDematalTable td { border: 1px solid #000 !important; padding: 2px; min-width: auto !important; background-color: #fff !important; word-break: break-all; vertical-align: middle; }
            #printSectionDematalTable th.aspect-header-print { height: 3em; }
            .diagonal-cell { background-color: #ccc !important; color: #ccc !important; }
            #printSectionPersonalData { display: block !important; margin-top: 20px; }
            #printSectionPersonalData h2 { font-size: 12pt; margin-bottom: 10px; }
            #printSectionPersonalData p { font-size: 10pt; margin-bottom: 5px; }
            button[type="submit"], .bg-sky-50, .bg-emerald-50, .bg-indigo-50, .bg-gray-50, .text-sky-700, .text-emerald-700, .text-indigo-700, .border-sky-200, .border-emerald-200, .border-indigo-200, .border-gray-200 { display: none !important; }
            .dematel-table-container { overflow: visible !important; }
            .dematel-table thead th, .dematel-table tbody td:first-child { position: static !important; }
        }
        #printSectionDematalTable, #printSectionPersonalData { display: none; }

        /* --- 7. 行動裝置響應式樣式 --- */
        @media (max-width: 768px) {
            .dematel-table-container { overflow-x: auto; max-height: 500px; }
            .dematel-table thead th.aspect-cell { 
                min-width: 4.5rem; height: auto; line-height: 1.3; font-size:0.75rem; padding-top: 0.3rem; padding-bottom: 0.3rem;
            }
            .dematel-table tbody td.aspect-name-col { 
                min-width: 5.8rem; font-size:0.75rem; line-height: 1.3; height: 3.2em;
            }
            .dematel-table thead th.aspect-name-col { 
                min-width: 7rem; font-size:0.75rem; line-height: 1.3; height: auto; padding-top: 0.3rem; padding-bottom: 0.3rem;
            }
            .dematel-table td.input-cell-container, .dematel-table td.diagonal-cell { height: 3.2em; }
            .input-cell { width: 100%; max-width:3.5em; font-size: 0.875rem; padding: 0.3rem 0.1rem;}
            .radio-options-grid { grid-template-columns: repeat(auto-fill, minmax(6rem, 1fr)); } 
            .example-table-示意 th, .example-table-示意 td { width: 2.5rem; height: 2.5rem; line-height: 2.5rem; font-size: 0.75rem; }
            .example-table-square th, .example-table-square td { width: 2.2rem; height: 2.2rem; line-height: 2.2rem; font-size: 0.75rem;}
            .personal-info-field.error-empty-group > label:first-of-type,
            .personal-info-field.error-empty-group .radio-options-grid,
            .personal-info-field.error-empty-group .flex.items-center.space-x-6,
            .personal-info-field.error-empty-group .flex.flex-col.space-y-2,
            #retired_options.error-empty-group {
                padding-left: 0.25rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <!-- 禁用瀏覽器提示區塊 -->
    <div id="browser-blocker">
        <div id="browser-blocker-content">
            <svg class="w-16 h-16 text-red-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">不支援的瀏覽器</h2>
            <p class="text-gray-600 mb-6 max-w-md">
                您目前使用的瀏覽器（如LINE或Juiker內建瀏覽器）可能無法支援本問卷的完整功能（如列印）。
                為了獲得最佳體驗，請使用手機的預設瀏覽器（如 Safari 或 Chrome）開啟。
            </p>
            <p class="text-gray-500 text-sm mb-4">請點擊右上角選單，並選擇「在預設瀏覽器中開啟」。</p>
            <button id="copyUrlButton" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                複製網址
            </button>
        </div>
    </div>

    <!-- 彈出式警示訊息 -->
    <div id="customAlert" class="custom-alert">
        <span id="customAlertMessage"></span>
        <button onclick="document.getElementById('customAlert').style.display='none'">&times;</button>
    </div>

    <!-- 主要問卷內容 -->
    <div id="main-content" class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-lg shadow-xl">
        <header class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-sky-700 mb-2">「影響空軍修護人員離職因素之研究」問卷</h1>
            <p class="text-sm text-gray-600">
                這是一份純學術之問卷研究，本問卷所有資料僅作為研究之目的，絕對保密，請您依實際感受最直接的反應填寫此份問卷，誠摯感謝您熱心的協助！
            </p>
            <div class="mt-2 text-xs text-gray-500">
                <p>國立台北大學企業管理研究所</p>
                <p>指導教授：劉仲矩 老師</p>
                <p>研究生：張靖興 學生</p>
            </div>
        </header>

        <section class="mb-8 p-4 bg-sky-50 rounded-md border border-sky-200">
            <h2 class="text-lg font-semibold text-sky-700 mb-3">壹、十五項構面影響關係之評比</h2>
            <p class="text-sm text-gray-700 mb-2"><strong>填寫指標說明：</strong></p>
            <ul class="list-disc list-inside text-sm text-gray-700 mb-3 space-y-1">
                <li><strong>0：</strong>完全沒有影響</li>
                <li><strong>1：</strong>低度影響</li>
                <li><strong>2：</strong>中度影響</li>
                <li><strong>3：</strong>高度影響</li>
                <li><strong>4：</strong>極高度影響</li>
            </ul>
            <div class="text-sm text-gray-700 space-y-2">
                <p><strong>舉例說明：</strong></p>
                <ul class="list-decimal list-inside ml-4 space-y-1">
                    <li>若您認為「構面A」對「構面B」的影響程度為「高影響」，則請在下表「構面A」列與「構面B」行的交叉儲存格中填入數字「3」。</li>
                    <li>若您認為「構面B」對「構面A」的影響程度為「極高影響」，則請在「構面B」列與「構面A」行的交叉儲存格中填入數字「4」。</li>
                </ul>
                <div class="flex justify-center my-3">
                    <div class="w-auto bg-white shadow">
                         <p class="text-center font-semibold mb-1 pt-2">影響程度示意</p>
                        <table class="example-table-示意"> 
                            <thead>
                                <tr><th> </th><th>構面A</th><th>構面B</th></tr>
                            </thead>
                            <tbody>
                                <tr><th>構面A</th><td class="diagonal-cell-示意">██</td><td>3</td></tr>
                                <tr><th>構面B</th><td>4</td><td class="diagonal-cell-示意">██</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <p class="font-medium bg-amber-100 p-2 rounded-md border border-amber-300">
                    <span class="font-bold text-red-600">請特別注意：</span>構面間互相影響並不一定相等（即表格右上半部與左下半部之答案不一定對稱）。對角線部分（構面對自身的影響）無需填寫。
                </p>
            </div>
        </section>

        <section class="mb-8 p-4 bg-emerald-50 rounded-md border border-emerald-200">
            <h2 class="text-lg font-semibold text-emerald-700 mb-3">貳、填答問卷之範例</h2>
            <p class="text-sm text-gray-700 mb-2">(0：無影響；1：低影響；2：中影響；3：高影響；4：極高影響)</p>
            <div class="overflow-x-auto pb-2">
                <table class="example-table-square"> 
                    <thead>
                        <tr>
                            <th></th> 
                            <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>A</strong></td><td class="diagonal-cell-example">██</td><td>3</td><td>4</td><td>2</td><td>0</td><td>1</td></tr>
                        <tr><td><strong>B</strong></td><td>0</td><td class="diagonal-cell-example">██</td><td>3</td><td>4</td><td>2</td><td>1</td></tr>
                        <tr><td><strong>C</strong></td><td>2</td><td>4</td><td class="diagonal-cell-example">██</td><td>3</td><td>3</td><td>4</td></tr>
                        <tr><td><strong>D</strong></td><td>3</td><td>4</td><td>1</td><td class="diagonal-cell-example">██</td><td>3</td><td>2</td></tr>
                        <tr><td><strong>E</strong></td><td>1</td><td>3</td><td>1</td><td>2</td><td class="diagonal-cell-example">██</td><td>4</td></tr>
                        <tr><td><strong>F</strong></td><td>0</td><td>4</td><td>2</td><td>1</td><td>3</td><td class="diagonal-cell-example">██</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="text-xs text-gray-600 mt-2"><em>(填答時請注意：此表格右上方與左下方之答案不一定對稱)</em></p>
        </section>

        <form id="dematelForm">
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">參、DEMATEL 影響程度評估表</h2>
                <div class="dematel-table-container">
                    <table class="min-w-full border-collapse dematel-table"> 
                        <thead>
                            <tr>
                                <th class="aspect-name-col">影響構面(i)↓ <br> 被影響構面(j)→</th>
                                <!-- Headers generated by JavaScript -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="mb-8 p-4 bg-indigo-50 rounded-md border border-indigo-200">
                 <h2 class="text-lg font-semibold text-indigo-700 mb-3">構面定義說明</h2>
                 <ul class="space-y-2 text-sm text-gray-700">
                    <li><strong>1. 勞役不均：</strong> 工作任務分配不合理，常以低階優先，導致部分人員承擔過多工作。</li>
                    <li><strong>2. 任務壓力：</strong> 工作時間過長，工作量過多或工作內容過於繁重導致身心疲憊。</li>
                    <li><strong>3. 職業傷害：</strong> 飛機修護環境噪音過大，或需長時間承受大量廢氣或化學溶劑。</li>
                    <li><strong>4. 薪資待遇：</strong> 薪資待遇沒辦法確實反應在高工時或高壓工作環境。</li>
                    <li><strong>5. 成就實現：</strong> 從工作中獲得的自我價值感與滿足感不足，缺乏對個人能力與貢獻的肯定。</li>
                    <li><strong>6. 職涯發展：</strong> 軍職專長與民間產業難以銜接，需提早退伍提升職涯競爭力。</li>
                    <li><strong>7. 社會認同：</strong> 自覺社會大眾對軍人職業認同感低，進而影響自豪感並降低留營意願。</li>
                    <li><strong>8. 期望落差：</strong> 部隊工作內容與個人預期想像落差過大。</li>
                    <li><strong>9. 權威壓迫：</strong> 單位存在不健康的權力關係，高階濫用職權使部屬感到壓迫及不尊重。</li>
                    <li><strong>10. 同袍互動：</strong> 同袍間價值觀、個性、工作行為相左在溝通協作上產生困難或衝突。</li>
                    <li><strong>11. 人力匱乏：</strong> 人員離退後單位職缺人力長時間未能補充，增加工時負荷。</li>
                    <li><strong>12. 輕視專業：</strong> 修護人員與飛行人員意見相左時，修護人員的意見往往難以被採納。</li>
                    <li><strong>13. 家庭照顧：</strong> 工作佔據私人時間過多對家庭照護不足無法充分陪伴家人。</li>
                    <li><strong>14. 就業市場：</strong> 民間企業提供更具吸引力的職涯發展機會工作選擇更加多元。</li>
                    <li><strong>15. 政策疑慮：</strong> 國家退撫、薪資政策變動頻繁，使得軍人對於未來權益保障產生不確定感與擔憂。</li>
                 </ul>
            </section>

            <section id="personalDataSection" class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">肆、個人基本資料</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div class="personal-info-field" data-field-name="gender">
                        <label class="block text-sm font-medium text-gray-700 mb-2">1. 性別：</label>
                        <div class="flex items-center space-x-6">
                            <label class="flex items-center"><input type="radio" name="gender" value="生理男" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 生理男</label>
                            <label class="flex items-center"><input type="radio" name="gender" value="生理女" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 生理女</label>
                        </div>
                    </div>
                    <div class="personal-info-field" data-field-name="experience">
                        <label class="block text-sm font-medium text-gray-700 mb-2">2. 年資：</label>
                        <div class="radio-options-grid mt-1">
                            <label class="flex items-center"><input type="radio" name="experience" value="0-5年" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 0-5年</label>
                            <label class="flex items-center"><input type="radio" name="experience" value="5-10年" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 5-10年</label>
                            <label class="flex items-center"><input type="radio" name="experience" value="10-15年" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 10-15年</label>
                            <label class="flex items-center"><input type="radio" name="experience" value="15-20年" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 15-20年</label>
                            <label class="flex items-center"><input type="radio" name="experience" value="20-25年(含以上)" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 20-25年(含以上)</label>
                        </div>
                    </div>
                    <div class="personal-info-field" data-field-name="education">
                        <label class="block text-sm font-medium text-gray-700 mb-2">3. 教育程度：</label>
                        <div class="radio-options-grid mt-1">
                            <label class="flex items-center"><input type="radio" name="education" value="高中" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 高中</label>
                            <label class="flex items-center"><input type="radio" name="education" value="專科" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 專科</label>
                            <label class="flex items-center"><input type="radio" name="education" value="大學" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 大學</label>
                            <label class="flex items-center"><input type="radio" name="education" value="研究所(含以上)" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 研究所(含以上)</label>
                        </div>
                    </div>
                    <div class="personal-info-field" data-field-name="rank">
                        <label class="block text-sm font-medium text-gray-700 mb-2">4. 階級：</label>
                        <div class="radio-options-grid mt-1">
                            <label class="flex items-center"><input type="radio" name="rank" value="士兵" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 士兵</label>
                            <label class="flex items-center"><input type="radio" name="rank" value="士官" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 士官</label>
                            <label class="flex items-center"><input type="radio" name="rank" value="軍官" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 軍官</label>
                        </div>
                    </div>
                    <div class="personal-info-field" data-field-name="job_type">
                        <label class="block text-sm font-medium text-gray-700 mb-2">5. 職務類型：</label>
                        <div class="flex items-center space-x-6">
                            <label class="flex items-center"><input type="radio" name="job_type" value="領導職" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 領導職</label>
                            <label class="flex items-center"><input type="radio" name="job_type" value="非領導職" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 非領導職</label>
                        </div>
                    </div>
                    <div class="personal-info-field" data-field-name="military_service_status">
                        <label class="block text-sm font-medium text-gray-700 mb-2">6. 兵役情況：</label>
                        <div class="flex flex-col space-y-2">
                             <label class="flex items-center"><input type="radio" name="military_service_status" value="現役" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 現役</label>
                             <div class="ml-0">
                                <label class="flex items-center mt-1"><input type="radio" name="military_service_status" value="已退役" id="retired_radio" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 已退役</label>
                                <div id="retired_options" class="ml-6 mt-1 space-y-1 hidden personal-info-field" data-field-name="military_service_detail">
                                   <label class="flex items-center"><input type="radio" name="military_service_detail" value="服滿役期" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 服滿役期</label>
                                   <label class="flex items-center"><input type="radio" name="military_service_detail" value="未服滿役期" class="focus:ring-sky-500 h-4 w-4 text-sky-600 border-gray-300 rounded mr-1.5"> 未服滿役期</label>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="mt-10 text-center">
                <button type="submit" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    提交問卷
                </button>
            </div>
        </form>

        <div id="printSectionDematalTable" style="display: none;">
             <h2 style="text-align:center; font-size:14pt; margin-bottom:15px;">DEMATEL 影響程度評估結果</h2>
        </div>
        <div id="printSectionPersonalData" style="display: none;">
            <h2 style="font-size:12pt; margin-bottom:10px;">個人基本資料</h2>
        </div>

        <footer class="mt-12 text-center text-sm text-gray-600 border-t pt-6">
            <p>此份問卷到此結束，感謝您在百忙之中撥冗填答，衷心感謝您對本研究之支持！</p>
        </footer>
    </div>

    <script>
        // --- 1. 初始化與全域變數 ---
        const aspects = [
            "勞役不均", "任務壓力", "職業傷害", "薪資待遇", "成就實現",
            "職涯發展", "社會認同", "期望落差", "權威壓迫", "同袍互動",
            "人力匱乏", "輕視專業", "家庭照顧", "就業市場", "政策疑慮"
        ];
        const dematelTable = document.querySelector('.dematel-table');
        const headerRow = dematelTable.querySelector('thead tr');
        const tbody = dematelTable.querySelector('tbody');

        // --- 2. 瀏覽器偵測與處理 ---
        document.addEventListener('DOMContentLoaded', function() {
            function isUnsupportedBrowser() {
                const userAgent = navigator.userAgent;
                // 偵測 LINE 或 Juiker 的 user agent 字串
                return /Line\//i.test(userAgent) || /Juiker/i.test(userAgent);
            }

            if (isUnsupportedBrowser()) {
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('browser-blocker').style.display = 'block';
            }

            const copyButton = document.getElementById('copyUrlButton');
            if (copyButton) {
                copyButton.addEventListener('click', function() {
                    const urlToCopy = window.location.href;
                    const textArea = document.createElement('textarea');
                    textArea.value = urlToCopy;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        showAlert('網址已複製！請貼到您的瀏覽器中開啟。');
                    } catch (err) {
                        showAlert('複製失敗，請手動複製網址。');
                        console.error('無法複製網址:', err);
                    }
                    document.body.removeChild(textArea);
                });
            }
        });


        // --- 3. UI 生成函式 ---
        function showAlert(message) {
            const alertBox = document.getElementById('customAlert');
            const alertMessage = document.getElementById('customAlertMessage');
            alertMessage.textContent = message;
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3500);
        }
        
        function formatAspectNameForDisplay(name) {
            if (name.length === 4) {
                return name.substring(0, 2) + '<br>' + name.substring(2, 4);
            }
            return name;
        }

        function generateDematalTable() {
            const firstHeaderCell = headerRow.querySelector('th');
            firstHeaderCell.innerHTML = '影響構面(i)↓ <br> 被影響構面(j)→';
            
            aspects.forEach(aspect => {
                const th = document.createElement('th');
                th.classList.add('aspect-cell'); 
                th.innerHTML = formatAspectNameForDisplay(aspect);
                headerRow.appendChild(th);
            });

            aspects.forEach((rowAspect, rowIndex) => {
                const tr = document.createElement('tr');
                const firstTd = document.createElement('td');
                firstTd.classList.add('aspect-name-col'); 
                firstTd.innerHTML = formatAspectNameForDisplay(rowAspect);
                tr.appendChild(firstTd);

                aspects.forEach((colAspect, colIndex) => {
                    const td = document.createElement('td');
                    if (rowIndex === colIndex) {
                        td.classList.add('diagonal-cell');
                        td.textContent = '██';
                    } else {
                        td.classList.add('input-cell-container');
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = '0';
                        input.max = '4';
                        input.name = `rating_${rowIndex}_${colIndex}`;
                        input.className = 'input-cell';
                        input.setAttribute('data-row', rowIndex);
                        input.setAttribute('data-col', colIndex);

                        input.addEventListener('input', function(e) {
                            e.target.classList.remove('error-empty', 'error-range');
                            const value = parseInt(e.target.value, 10);
                            if (e.target.value !== "" && (isNaN(value) || value < 0 || value > 4)) {
                                showAlert('輸入錯誤！請輸入 0 到 4 之間的數字。');
                                e.target.value = '';
                                e.target.classList.add('error-range'); 
                            }
                        });
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                            }
                        });
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }
        
        // --- 4. 列印內容生成函式 ---
        function formatAspectNameForPrint(name) { return name.length === 4 ? name.substring(0,2)+'<br>'+name.substring(2,4) : name; }
        function generatePrintableDematalTable(data) { 
            const tableContainer = document.getElementById('printSectionDematalTable');
            tableContainer.innerHTML = '<h2 style="text-align:center; font-size:14pt; margin-bottom:15px;">DEMATEL 影響程度評估結果</h2>';
            const table = document.createElement('table');
            table.style.width = '100%'; table.style.borderCollapse = 'collapse'; table.style.fontSize = '8pt'; table.style.tableLayout = 'fixed';
            const thead = table.createTHead(); const headerRowPrint = thead.insertRow(); 
            let thPrint = headerRowPrint.insertCell(); 
            thPrint.innerHTML = '影響構面↓<br>被影響構面→';
            thPrint.style.cssText = 'border: 1px solid black; padding: 2px; background-color: #f0f0f0; vertical-align: middle;';
            aspects.forEach(aspect => {
                thPrint = headerRowPrint.insertCell(); 
                thPrint.innerHTML = formatAspectNameForPrint(aspect);
                thPrint.style.cssText = 'border: 1px solid black; padding: 2px; background-color: #f0f0f0; text-align: center; vertical-align: middle;';
                thPrint.classList.add('aspect-header-print');
            });
            const tbodyPrint = table.createTBody();
            aspects.forEach((rowAspect, rowIndex) => {
                const trPrint = tbodyPrint.insertRow(); 
                let tdPrint = trPrint.insertCell(); 
                tdPrint.innerHTML = formatAspectNameForPrint(rowAspect);
                tdPrint.style.cssText = 'border: 1px solid black; padding: 2px; font-weight: bold; background-color: #f0f0f0; text-align: center; vertical-align: middle;';
                aspects.forEach((colAspect, colIndex) => {
                    tdPrint = trPrint.insertCell(); 
                    if (rowIndex === colIndex) {
                        tdPrint.textContent = '██';
                        tdPrint.style.cssText = 'border: 1px solid black; padding: 2px; text-align: center; vertical-align: middle; background-color: #cccccc; color: #cccccc;';
                    } else {
                        const key = `${rowAspect}_影響_${colAspect}`;
                        tdPrint.textContent = data[key] !== null && data[key] !== "無效輸入" ? data[key] : '-';
                        tdPrint.style.cssText = 'border: 1px solid black; padding: 2px; text-align: center; vertical-align: middle;';
                    }
                });
            });
            tableContainer.appendChild(table);
        }
        function generatePrintablePersonalData(data) { 
            const container = document.getElementById('printSectionPersonalData');
            container.innerHTML = '<h2 style="font-size:12pt; margin-bottom:10px;">個人基本資料</h2>';
            const personalDataMap = {
                gender: "1. 性別", experience: "2. 年資", education: "3. 教育程度", rank: "4. 階級", job_type: "5. 職務類型", military_service_status: "6. 兵役情況", military_service_detail: "   - 詳細情況"
            };
            for (const key in personalDataMap) {
                if (data[key] !== undefined && data[key] !== null) {
                    if (key === 'military_service_detail' && data['military_service_status'] !== '已退役') continue;
                    const p = document.createElement('p');
                    p.style.fontSize = '10pt'; p.style.marginBottom = '5px';
                    p.textContent = `${personalDataMap[key]}：${data[key] || '未填寫'}`;
                    container.appendChild(p);
                }
            }
        }
        
        // --- 5. 事件監聽器與主邏輯 ---
        generateDematalTable(); // 頁面載入時生成DEMATEL表格

        const retiredRadio = document.getElementById('retired_radio');
        const retiredOptions = document.getElementById('retired_options');
        const activeRadio = document.querySelector('input[name="military_service_status"][value="現役"]');
        
        function toggleRetiredOptions() {
            if (retiredRadio && retiredRadio.checked) {
                if(retiredOptions) retiredOptions.classList.remove('hidden');
            } else {
                if(retiredOptions) retiredOptions.classList.add('hidden');
                document.querySelectorAll('input[name="military_service_detail"]').forEach(radio => radio.checked = false);
            }
        }
        
        if(activeRadio) activeRadio.addEventListener('change', toggleRetiredOptions);
        if(retiredRadio) retiredRadio.addEventListener('change', toggleRetiredOptions);
        toggleRetiredOptions();

        // 為個人資料選項添加事件監聽器，以便在選擇後清除錯誤狀態
        document.querySelectorAll('#personalDataSection input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                let fieldContainer = this.closest('.personal-info-field');
                if (fieldContainer) fieldContainer.classList.remove('error-empty-group');
                if(this.name === 'military_service_detail' && document.querySelector('input[name="military_service_detail"]:checked')) {
                    const detailContainer = document.getElementById('retired_options');
                    if(detailContainer) detailContainer.classList.remove('error-empty-group');
                }
                if(this.name === 'military_service_status' && document.querySelector('input[name="military_service_status"]:checked')){
                    const statusContainer = document.querySelector('.personal-info-field[data-field-name="military_service_status"]');
                     if(statusContainer) statusContainer.classList.remove('error-empty-group');
                }
            });
        });

        // 表單提交的主要處理函式
        document.getElementById('dematelForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // 清除所有舊的錯誤標記
            document.querySelectorAll('.input-cell.error-empty, .input-cell.error-range').forEach(el => el.classList.remove('error-empty', 'error-range'));
            document.querySelectorAll('.personal-info-field.error-empty-group').forEach(el => el.classList.remove('error-empty-group'));
            if (document.getElementById('retired_options').classList.contains('error-empty-group')) {
                document.getElementById('retired_options').classList.remove('error-empty-group');
            }

            const formData = new FormData(this);
            const collectedData = {};
            let dematelAllFilled = true;
            let firstEmptyDematalElement = null;
            let dematelAllValidRange = true;
            let firstRangeErrorDematalElement = null;
            let personalInfoAllValid = true;
            let firstEmptyPersonalInfoElement = null;

            // 驗證階段 1: DEMATEL表格 - 未填答檢查
            aspects.forEach((rowAspect, rowIndex) => {
                aspects.forEach((colAspect, colIndex) => {
                    if (rowIndex !== colIndex) {
                        const inputField = document.querySelector(`input[name="rating_${rowIndex}_${colIndex}"]`);
                        if (inputField.value.trim() === "") {
                            dematelAllFilled = false;
                            inputField.classList.add('error-empty');
                            if (!firstEmptyDematalElement) firstEmptyDematalElement = inputField;
                        }
                    }
                });
            });

            if (!dematelAllFilled) {
                showAlert('DEMATEL評估表尚有未填答的儲存格，請全部填寫完成後再提交。');
                if (firstEmptyDematalElement) {
                    firstEmptyDematalElement.focus();
                    firstEmptyDematalElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }

            // 驗證階段 2: DEMATEL表格 - 範圍檢查
            aspects.forEach((rowAspect, rowIndex) => {
                aspects.forEach((colAspect, colIndex) => {
                    if (rowIndex !== colIndex) {
                        const inputField = document.querySelector(`input[name="rating_${rowIndex}_${colIndex}"]`);
                        const value = parseInt(inputField.value, 10);
                        if (isNaN(value) || value < 0 || value > 4) {
                            dematelAllValidRange = false;
                            inputField.classList.add('error-range');
                            if (!firstRangeErrorDematalElement) firstRangeErrorDematalElement = inputField;
                        }
                    }
                });
            });

            if (!dematelAllValidRange) {
                showAlert('部分DEMATEL評分輸入無效或超出範圍 (0-4)，請檢查標示的欄位。');
                if (firstRangeErrorDematalElement) {
                     firstRangeErrorDematalElement.focus();
                     firstRangeErrorDematalElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }

            // 驗證階段 3: 個人基本資料檢查
            const personalInfoFieldSelectors = [
                "gender", "experience", "education", "rank", "job_type", "military_service_status"
            ];

            personalInfoFieldSelectors.forEach(fieldName => {
                if (!formData.get(fieldName)) {
                    personalInfoAllValid = false;
                    const container = document.querySelector(`.personal-info-field[data-field-name="${fieldName}"]`);
                    if (container) {
                        container.classList.add('error-empty-group');
                        if (!firstEmptyPersonalInfoElement) firstEmptyPersonalInfoElement = container;
                    }
                }
            });

            const militaryStatusValue = formData.get('military_service_status');
            if (militaryStatusValue === '已退役' && !formData.get('military_service_detail')) {
                personalInfoAllValid = false;
                const retiredOptionsContainer = document.getElementById('retired_options');
                retiredOptionsContainer.classList.add('error-empty-group');
                if (!firstEmptyPersonalInfoElement) firstEmptyPersonalInfoElement = retiredOptionsContainer.closest('.personal-info-field');
            }

            if (!personalInfoAllValid) {
                showAlert('個人基本資料尚有項目未填寫，請檢查並完成後再提交。');
                if (firstEmptyPersonalInfoElement) {
                    firstEmptyPersonalInfoElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    const firstRadioToFocus = firstEmptyPersonalInfoElement.querySelector('input[type="radio"]');
                    if(firstRadioToFocus) firstRadioToFocus.focus();
                }
                return;
            }

            // 所有驗證通過後，收集資料
            aspects.forEach((rowAspect, rowIndex) => {
                aspects.forEach((colAspect, colIndex) => {
                    if (rowIndex !== colIndex) {
                         const value = parseInt(formData.get(`rating_${rowIndex}_${colIndex}`), 10);
                         collectedData[`${rowAspect}_影響_${colAspect}`] = value;
                    }
                });
            });
            collectedData.gender = formData.get('gender') || "未填寫";
            collectedData.experience = formData.get('experience') || "未填寫";
            collectedData.education = formData.get('education') || "未填寫";
            collectedData.rank = formData.get('rank') || "未填寫";
            collectedData.job_type = formData.get('job_type') || "未填寫";
            collectedData.military_service_status = militaryStatusValue || "未填寫";
            if (militaryStatusValue === '已退役') {
                collectedData.military_service_detail = formData.get('military_service_detail') || "未選擇詳細情況";
            } else {
                collectedData.military_service_detail = null;
            }

            console.log("表單資料（準備列印）：", collectedData);

            // 準備並觸發列印
            generatePrintableDematalTable(collectedData);
            generatePrintablePersonalData(collectedData);
            
            setTimeout(() => {
                 console.log("準備觸發 window.print()");
                 window.print();
                 showAlert('問卷資料已準備好列印。');
            }, 500); 
        });
    </script>
</body>
</html>
